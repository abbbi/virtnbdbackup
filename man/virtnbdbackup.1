.\" DO NOT MODIFY THIS FILE!  It was generated by help2man 1.49.3.
.TH VIRTNBDBACKUP "1" "March 2024" "virtnbdbackup 2.6" "User Commands"
.SH NAME
virtnbdbackup \- backup utility for libvirt
.SH DESCRIPTION
usage: virtnbdbackup [\-h] \fB\-d\fR DOMAIN [\-l {copy,full,inc,diff,auto}]
.TP
[\-t {stream,raw}] [\-r] \fB\-o\fR OUTPUT [\-C CHECKPOINTDIR]
[\-\-scratchdir SCRATCHDIR] [\-S] [\-i INCLUDE] [\-x EXCLUDE]
[\-f SOCKETFILE] [\-n] [\-z [COMPRESS]] [\-w WORKER]
[\-F FREEZE_MOUNTPOINT] [\-e] [\-T THRESHOLD] [\-U URI]
[\-\-user USER] [\-\-ssh\-user SSH_USER] [\-\-password PASSWORD]
[\-P NBD_PORT] [\-I NBD_IP] [\-\-tls] [\-\-tls\-cert TLS_CERT]
[\-L] [\-\-quiet] [\-\-nocolor] [\-q] [\-s] [\-k] [\-p] [\-v] [\-V]
.PP
Backup libvirt/qemu virtual machines
.SS "options:"
.TP
\fB\-h\fR, \fB\-\-help\fR
show this help message and exit
.SS "General options:"
.TP
\fB\-d\fR DOMAIN, \fB\-\-domain\fR DOMAIN
Domain to backup
.TP
\fB\-l\fR {copy,full,inc,diff,auto}, \fB\-\-level\fR {copy,full,inc,diff,auto}
Backup level. (default: copy)
.TP
\fB\-t\fR {stream,raw}, \fB\-\-type\fR {stream,raw}
Output type: stream or raw. (default: stream)
.TP
\fB\-r\fR, \fB\-\-raw\fR
Include full provisioned disk images in backup. (default: False)
.TP
\fB\-o\fR OUTPUT, \fB\-\-output\fR OUTPUT
Output target directory
.TP
\fB\-C\fR CHECKPOINTDIR, \fB\-\-checkpointdir\fR CHECKPOINTDIR
Persistent libvirt checkpoint storage directory
.TP
\fB\-\-scratchdir\fR SCRATCHDIR
Target dir for temporary scratch file. (default: \fI\,/var/tmp\/\fP)
.TP
\fB\-S\fR, \fB\-\-start\-domain\fR
Start virtual machine if it is offline. (default: False)
.TP
\fB\-i\fR INCLUDE, \fB\-\-include\fR INCLUDE
Backup only disk with target dev name (\fB\-i\fR vda)
.TP
\fB\-x\fR EXCLUDE, \fB\-\-exclude\fR EXCLUDE
Exclude disk(s) with target dev name (\fB\-x\fR vda,vdb)
.TP
\fB\-f\fR SOCKETFILE, \fB\-\-socketfile\fR SOCKETFILE
Use specified file for NBD Server socket (default: \fI\,/var/tmp/virtnbdbackup.163278\/\fP)
.TP
\fB\-n\fR, \fB\-\-noprogress\fR
Disable progress bar
.TP
\fB\-z\fR [COMPRESS], \fB\-\-compress\fR [COMPRESS]
Compress with lz4 compression level. (default: False)
.TP
\fB\-w\fR WORKER, \fB\-\-worker\fR WORKER
Amount of concurrent workers used to backup multiple disks. (default: amount of disks)
.TP
\fB\-F\fR FREEZE_MOUNTPOINT, \fB\-\-freeze\-mountpoint\fR FREEZE_MOUNTPOINT
If qemu agent available, freeze only filesystems on specified mountpoints within virtual machine (default: all)
.TP
\fB\-e\fR, \fB\-\-strict\fR
Change exit code if warnings occur during backup operation. (default: False)
.TP
\fB\-T\fR THRESHOLD, \fB\-\-threshold\fR THRESHOLD
Execute backup only if threshold is reached.
.SS "Remote Backup options:"
.TP
\fB\-U\fR URI, \fB\-\-uri\fR URI
Libvirt connection URI. (default: qemu:///session)
.TP
\fB\-\-user\fR USER
User to authenticate against libvirtd. (default: None)
.TP
\fB\-\-ssh\-user\fR SSH_USER
User to authenticate against remote sshd: used for remote copy of files. (default: abi)
.TP
\fB\-\-password\fR PASSWORD
Password to authenticate against libvirtd. (default: None)
.TP
\fB\-P\fR NBD_PORT, \fB\-\-nbd\-port\fR NBD_PORT
Port used by remote NBD Service, should be unique for each started backup. (default: 10809)
.TP
\fB\-I\fR NBD_IP, \fB\-\-nbd\-ip\fR NBD_IP
IP used to bind remote NBD service on (default: hostname returned by libvirtd)
.TP
\fB\-\-tls\fR
Enable and use TLS for NBD connection. (default: False)
.TP
\fB\-\-tls\-cert\fR TLS_CERT
Path to TLS certificates used during offline backup and restore. (default: /etc/pki/qemu/)
.SS "Logging options:"
.TP
\fB\-L\fR, \fB\-\-syslog\fR
Additionally send log messages to syslog (default: False)
.TP
\fB\-\-quiet\fR
Disable logging to stderr (default: False)
.TP
\fB\-\-nocolor\fR
Disable colored output (default: False)
.SS "Debug options:"
.TP
\fB\-q\fR, \fB\-\-qemu\fR
Use Qemu tools to query extents.
.TP
\fB\-s\fR, \fB\-\-startonly\fR
Only initialize backup job via libvirt, do not backup any data
.TP
\fB\-k\fR, \fB\-\-killonly\fR
Kill any running block job
.TP
\fB\-p\fR, \fB\-\-printonly\fR
Quit after printing estimated checkpoint size.
.TP
\fB\-v\fR, \fB\-\-verbose\fR
Enable debug output
.TP
\fB\-V\fR, \fB\-\-version\fR
Show version and exit
.SH EXAMPLES
.IP
# full backup of domain 'webvm' with all attached disks:
.IP
virtnbdbackup \-d webvm \-l full \-o /backup/
.IP
# incremental backup:
.IP
virtnbdbackup \-d webvm \-l inc \-o /backup/
.IP
# differential backup:
.IP
virtnbdbackup \-d webvm \-l diff \-o /backup/
.IP
# full backup, exclude disk 'vda':
.IP
virtnbdbackup \-d webvm \-l full \-x vda \-o /backup/
.IP
# full backup, backup only disk 'vdb':
.IP
virtnbdbackup \-d webvm \-l full \-i vdb \-o /backup/
.IP
# full backup, compression enabled:
.IP
virtnbdbackup \-d webvm \-l full \-z \-o /backup/
.IP
# full backup, create archive:
.IP
virtnbdbackup \-d webvm \-l full \-o \- > backup.zip
.IP
# full backup of vm operating on remote libvirtd:
.IP
virtnbdbackup \-U qemu+ssh://root@remotehost/system \-\-ssh\-user root \-d webvm \-l full \-o /backup/
